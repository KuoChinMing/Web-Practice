class Calculator{constructor(t,e,o){this.operationTextElement=t,this.instantResultTextElement=e,this.operatorCollection=o,this.clear()}clear(){this.operation="",this.instantResult="",this.currentNumber=""}delete(){this.operation=this.operation.slice(0,-1)}appendNumber(t){"."===t&&this.currentNumber.includes(".")||(this.currentNumber+=t.toString(),this.operation+=t.toString())}appendOperator(t){const e=this.operation[this.operation.length-1];e||(this.operation+="0"),this.operatorCollection.includes(e)&&(this.operation=this.operation.slice(0,-1)),this.operation+=t.toString(),this.currentNumber=""}operationToArray(t){let e="";const o=[];for(let a=0;a<t.length;a++)this.operatorCollection.includes(t[a])?(o.push(e,t[a]),e=""):e+=t[a];return""!==e&&o.push(e),o}toPostfix(t){const e=[],o=[];for(let a=0;a<t.length;a++)if(this.operatorCollection.includes(t[a]))if(0===o.length)o.push(t[a]);else{const r=o[o.length-1];"*/%".includes(t[a])&&"+-".includes(r)?o.push(t[a]):(e.push(o.pop()),o.push(t[a]))}else e.push(t[a]);for(;o.length>0;)e.push(o.pop());return e}compute(){this.instantResult=this.operation;const t=this.operationToArray(this.instantResult),e=this.toPostfix(t),o=[];e.forEach(t=>{if(this.operatorCollection.includes(t)){const e=o.pop(),a=o.pop();switch(t){case"+":o.push(a+e);break;case"-":o.push(a-e);break;case"*":o.push(a*e);break;case"/":o.push(a/e);break;case"%":o.push(a%e)}}else o.push(Number(t))}),this.instantResult=isNaN(o[0])||o[0]===1/0?NaN:o[0].toString()}getResult(){isNaN(this.instantResult)?console.log("不要隨便亂輸入好嗎? 防呆很累"):""===this.instantResult?console.log("看起來你不需要計算"):(this.operation=this.instantResult,this.instantResult="")}getDisplayNumber(t){const e=t.toString(),o=parseFloat(e.split(".")[0]),a=e.split(".")[1];let r;return r=isNaN(o)?"":o.toLocaleString("en",{maximumFractionDigits:0}),null!=a?`${r}.${a}`:r}getDisplay(t){let e="";return t.forEach(t=>{this.operatorCollection.includes(t)?e+=t:e+=this.getDisplayNumber(t)}),e}updateDisplay(){const t=this.operationToArray(this.operation);if(this.operationTextElement.innerText=this.getDisplay(t),isNaN(this.instantResult))this.instantResultTextElement.innerText="";else{const t=this.operationToArray(this.instantResult);this.instantResultTextElement.innerText=this.getDisplay(t)}}}const numberButtons=document.querySelectorAll("[data-number]"),operatorButtons=document.querySelectorAll("[data-operator]"),deleteButton=document.querySelector("[data-delete]"),clearButton=document.querySelector("[data-clear]"),equalsButton=document.querySelector("[data-equals]"),operationTextElement=document.querySelector("[data-operation]"),instantResultTextElement=document.querySelector("[data-instant-result]");let calculatorOperator="";operatorButtons.forEach(t=>{calculatorOperator+=t.innerText});const calculator=new Calculator(operationTextElement,instantResultTextElement,calculatorOperator);numberButtons.forEach(t=>{t.addEventListener("click",()=>{calculator.appendNumber(t.innerText),calculator.compute(),calculator.updateDisplay()})}),operatorButtons.forEach(t=>{t.addEventListener("click",()=>{calculator.appendOperator(t.innerText),calculator.compute(),calculator.updateDisplay()})}),equalsButton.addEventListener("click",()=>{calculator.getResult(),calculator.updateDisplay()}),clearButton.addEventListener("click",()=>{calculator.clear(),calculator.updateDisplay()}),deleteButton.addEventListener("click",()=>{calculator.delete(),calculator.compute(),calculator.updateDisplay()});const numberArr=["1","2","3","4","5","6","7","8","9","0","."];document.addEventListener("keydown",t=>{numberArr.includes(t.key)?(calculator.appendNumber(t.key),calculator.compute()):"Backspace"===t.key?(calculator.delete(),calculator.compute()):"-"===t.key||"/"===t.key||t.shiftKey&&("+"===t.key||"*"===t.key||"%"===t.key)?(calculator.appendOperator(t.key),calculator.compute()):"Enter"===t.key||"="===t.key?calculator.getResult():"Escape"===t.key&&calculator.clear(),calculator.updateDisplay()});const colorThemeSwitch=document.querySelector("#colorTheme"),colorTheme=localStorage.getItem("colorTheme");"dark"===colorTheme?(colorThemeSwitch.checked=!0,document.documentElement.setAttribute("data-theme","dark")):(colorThemeSwitch.checked=!1,document.documentElement.setAttribute("data-theme","light")),colorThemeSwitch.addEventListener("change",(function(){this.checked?(document.documentElement.setAttribute("data-theme","dark"),localStorage.setItem("colorTheme","dark")):(document.documentElement.setAttribute("data-theme","light"),localStorage.setItem("colorTheme","light"))}));
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImluZGV4LmpzIl0sIm5hbWVzIjpbIkNhbGN1bGF0b3IiLCJbb2JqZWN0IE9iamVjdF0iLCJvcGVyYXRpb25UZXh0RWxlbWVudCIsImluc3RhbnRSZXN1bHRUZXh0RWxlbWVudCIsIm9wZXJhdG9yQ29sbGVjdGlvbiIsInRoaXMiLCJjbGVhciIsIm9wZXJhdGlvbiIsImluc3RhbnRSZXN1bHQiLCJjdXJyZW50TnVtYmVyIiwic2xpY2UiLCJudW1iZXIiLCJpbmNsdWRlcyIsInRvU3RyaW5nIiwib3BlcmF0b3IiLCJsYXN0Q2hhciIsImxlbmd0aCIsIm9wZXJhdGlvblN0cmluZyIsIm9wZXJhdGlvbkFycmF5IiwiaSIsInB1c2giLCJvcGVyYXRpb25Qb3N0Zml4Iiwib3BlcmF0b3JTdGFjayIsInVwcGVybW9zdE9wZXJhdG9yIiwicG9wIiwib3BlcmF0aW9uVG9BcnJheSIsInRvUG9zdGZpeCIsInJlc3VsdCIsImZvckVhY2giLCJzZWNvbmRPcGVyYXRpb24iLCJmaXJzdE9wZXJhdGlvbiIsIk51bWJlciIsImlzTmFOIiwiSW5maW5pdHkiLCJOYU4iLCJjb25zb2xlIiwibG9nIiwibnVtYmVyU3RyaW5nIiwiaW50ZWdlckRpZ2l0cyIsInBhcnNlRmxvYXQiLCJzcGxpdCIsImRlY2ltYWxEaWdpdHMiLCJpbnRlZ2VyRGlzcGxheSIsInRvTG9jYWxlU3RyaW5nIiwibWF4aW11bUZyYWN0aW9uRGlnaXRzIiwiZGlzcGxheSIsImdldERpc3BsYXlOdW1iZXIiLCJpbm5lclRleHQiLCJnZXREaXNwbGF5IiwicmVzdWx0QXJyYXkiLCJudW1iZXJCdXR0b25zIiwiZG9jdW1lbnQiLCJxdWVyeVNlbGVjdG9yQWxsIiwib3BlcmF0b3JCdXR0b25zIiwiZGVsZXRlQnV0dG9uIiwicXVlcnlTZWxlY3RvciIsImNsZWFyQnV0dG9uIiwiZXF1YWxzQnV0dG9uIiwiY2FsY3VsYXRvck9wZXJhdG9yIiwiYnV0dG9uIiwiY2FsY3VsYXRvciIsImFkZEV2ZW50TGlzdGVuZXIiLCJhcHBlbmROdW1iZXIiLCJjb21wdXRlIiwidXBkYXRlRGlzcGxheSIsImFwcGVuZE9wZXJhdG9yIiwiZ2V0UmVzdWx0IiwiZGVsZXRlIiwibnVtYmVyQXJyIiwiZSIsImtleSIsInNoaWZ0S2V5IiwiY29sb3JUaGVtZVN3aXRjaCIsImNvbG9yVGhlbWUiLCJsb2NhbFN0b3JhZ2UiLCJnZXRJdGVtIiwiY2hlY2tlZCIsImRvY3VtZW50RWxlbWVudCIsInNldEF0dHJpYnV0ZSIsInNldEl0ZW0iXSwibWFwcGluZ3MiOiJBQU9BLE1BQU1BLFdBQ0pDLFlBQ0VDLEVBQ0FDLEVBQ0FDLEdBRUFDLEtBQUtILHFCQUF1QkEsRUFDNUJHLEtBQUtGLHlCQUEyQkEsRUFDaENFLEtBQUtELG1CQUFxQkEsRUFDMUJDLEtBQUtDLFFBR1BMLFFBQ0VJLEtBQUtFLFVBQVksR0FDakJGLEtBQUtHLGNBQWdCLEdBQ3JCSCxLQUFLSSxjQUFnQixHQUd2QlIsU0FDRUksS0FBS0UsVUFBWUYsS0FBS0UsVUFBVUcsTUFBTSxHQUFJLEdBRzVDVCxhQUFhVSxHQUNJLE1BQVhBLEdBQWtCTixLQUFLSSxjQUFjRyxTQUFTLE9BR2xEUCxLQUFLSSxlQUFpQkUsRUFBT0UsV0FDN0JSLEtBQUtFLFdBQWFJLEVBQU9FLFlBRzNCWixlQUFlYSxHQUNiLE1BQU1DLEVBQVdWLEtBQUtFLFVBQVVGLEtBQUtFLFVBQVVTLE9BQVMsR0FDbkRELElBQ0hWLEtBQUtFLFdBQWEsS0FHaEJGLEtBQUtELG1CQUFtQlEsU0FBU0csS0FDbkNWLEtBQUtFLFVBQVlGLEtBQUtFLFVBQVVHLE1BQU0sR0FBSSxJQUU1Q0wsS0FBS0UsV0FBYU8sRUFBU0QsV0FDM0JSLEtBQUtJLGNBQWdCLEdBSXZCUixpQkFBaUJnQixHQUNmLElBQUlOLEVBQVMsR0FDYixNQUFNTyxFQUFpQixHQUN2QixJQUFLLElBQUlDLEVBQUksRUFBR0EsRUFBSUYsRUFBZ0JELE9BQVFHLElBQ3RDZCxLQUFLRCxtQkFBbUJRLFNBQVNLLEVBQWdCRSxLQUNuREQsRUFBZUUsS0FBS1QsRUFBUU0s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TUFBVkQsRUFBRUMsTUFFcERWLFdBQVdLLGVBQWVJLEVBQUVDLEtBQzVCVixXQUFXRyxXQUNRLFVBQVZNLEVBQUVDLEtBQTZCLE1BQVZELEVBQUVDLElBQ2hDVixXQUFXTSxZQUNRLFdBQVZHLEVBQUVDLEtBQ1hWLFdBQVd0RCxRQUVic0QsV0FBV0ksa0JBSWIsTUFBTVEsaUJBQW1CckIsU0FBU0ksY0FBYyxlQUMxQ2tCLFdBQWFDLGFBQWFDLFFBQVEsY0FDckIsU0FBZkYsWUFDRkQsaUJBQWlCSSxTQUFVLEVBQzNCekIsU0FBUzBCLGdCQUFnQkMsYUFBYSxhQUFjLFVBR3BETixpQkFBaUJJLFNBQVUsRUFDM0J6QixTQUFTMEIsZ0JBQWdCQyxhQUFhLGFBQWMsVUFFdEROLGlCQUFpQlgsaUJBQWlCLFVBQVUsV0FDdEN4RCxLQUFLdUUsU0FDUHpCLFNBQVMwQixnQkFBZ0JDLGFBQWEsYUFBYyxRQUNwREosYUFBYUssUUFBUSxhQUFjLFVBRW5DNUIsU0FBUzBCLGdCQUFnQkMsYUFBYSxhQUFjLFNBQ3BESixhQUFhSyxRQUFRLGFBQWMiLCJmaWxlIjoiaW5kZXguanMiLCJzb3VyY2VzQ29udGVudCI6WyIvLyB0dXRvcmlhbDogaHR0cHM6Ly93d3cueW91dHViZS5jb20vd2F0Y2g/dj1qNTlxUTdZV0x4dyZsaXN0PUxMSGtEd0c3MElQY2RIeFVPUUVYZlpNd1xuXG4vLyBpc3N1ZTpcbi8vICA0LjggLyAzID0gMS41OTk5OTk5OTk5OTk5OTk5XG4vLyAgaW5wdXQgcGFyZW50aGVzZXNcbi8vICBuZWdhdGl2ZSBudW1iZXJcblxuY2xhc3MgQ2FsY3VsYXRvciB7XG4gIGNvbnN0cnVjdG9yKFxuICAgIG9wZXJhdGlvblRleHRFbGVtZW50LFxuICAgIGluc3RhbnRSZXN1bHRUZXh0RWxlbWVudCxcbiAgICBvcGVyYXRvckNvbGxlY3Rpb25cbiAgKSB7XG4gICAgdGhpcy5vcGVyYXRpb25UZXh0RWxlbWVudCA9IG9wZXJhdGlvblRleHRFbGVtZW50O1xuICAgIHRoaXMuaW5zdGFudFJlc3VsdFRleHRFbGVtZW50ID0gaW5zdGFudFJlc3VsdFRleHRFbGVtZW50O1xuICAgIHRoaXMub3BlcmF0b3JDb2xsZWN0aW9uID0gb3BlcmF0b3JDb2xsZWN0aW9uO1xuICAgIHRoaXMuY2xlYXIoKTtcbiAgfVxuXG4gIGNsZWFyKCkge1xuICAgIHRoaXMub3BlcmF0aW9uID0gJyc7XG4gICAgdGhpcy5pbnN0YW50UmVzdWx0ID0gJyc7XG4gICAgdGhpcy5jdXJyZW50TnVtYmVyID0gJyc7XG4gIH1cblxuICBkZWxldGUoKSB7XG4gICAgdGhpcy5vcGVyYXRpb24gPSB0aGlzLm9wZXJhdGlvbi5zbGljZSgwLCAtMSk7XG4gIH1cblxuICBhcHBlbmROdW1iZXIobnVtYmVyKSB7XG4gICAgaWYgKG51bWJlciA9PT0gJy4nICYmIHRoaXMuY3VycmVudE51bWJlci5pbmNsdWRlcygnLicpKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIHRoaXMuY3VycmVudE51bWJlciArPSBudW1iZXIudG9TdHJpbmcoKTtcbiAgICB0aGlzLm9wZXJhdGlvbiArPSBudW1iZXIudG9TdHJpbmcoKTtcbiAgfVxuXG4gIGFwcGVuZE9wZXJhdG9yKG9wZXJhdG9yKSB7XG4gICAgY29uc3QgbGFzdENoYXIgPSB0aGlzLm9wZXJhdGlvblt0aGlzLm9wZXJhdGlvbi5sZW5ndGggLSAxXTtcbiAgICBpZiAoIWxhc3RDaGFyKSB7XG4gICAgICB0aGlzLm9wZXJhdGlvbiArPSAnMCc7XG4gICAgfVxuICAgIC8vIGlmIGxhc3QgY2hhciBhbHJlYWR5IGlzIGEgb3BlcmF0b3IsIHRoZW4gcmVwYWxjZVxuICAgIGlmICh0aGlzLm9wZXJhdG9yQ29sbGVjdGlvbi5pbmNsdWRlcyhsYXN0Q2hhcikpIHtcbiAgICAgIHRoaXMub3BlcmF0aW9uID0gdGhpcy5vcGVyYXRpb24uc2xpY2UoMCwgLTEpO1xuICAgIH1cbiAgICB0aGlzLm9wZXJhdGlvbiArPSBvcGVyYXRvci50b1N0cmluZygpO1xuICAgIHRoaXMuY3VycmVudE51bWJlciA9ICcnO1xuICB9XG5cbiAgLy8gaW5wdXQgYSBvcGVyYXRpb24gc3RyaW5nLCBzcGxpdCBieSBvcGVyYXRvciwgYW5kIG91dHB1dCBhIGFycmF5XG4gIG9wZXJhdGlvblRvQXJyYXkob3BlcmF0aW9uU3RyaW5nKSB7XG4gICAgbGV0IG51bWJlciA9ICcnO1xuICAgIGNvbnN0IG9wZXJhdGlvbkFycmF5ID0gW107XG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCBvcGVyYXRpb25TdHJpbmcubGVuZ3RoOyBpKyspIHtcbiAgICAgIGlmICh0aGlzLm9wZXJhdG9yQ29sbGVjdGlvbi5pbmNsdWRlcyhvcGVyYXRpb25TdHJpbmdbaV0pKSB7XG4gICAgICAgIG9wZXJhdGlvbkFycmF5LnB1c2gobnVtYmVyLCBvcGVyYXRpb25TdHJpbmdbaV0pO1xuICAgICAgICBudW1iZXIgPSAnJztcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIG51bWJlciArPSBvcGVyYXRpb25TdHJpbmdbaV07XG4gICAgICB9XG4gICAgfVxuICAgIGlmIChudW1iZXIgIT09ICcnKSB7XG4gICAgICBvcGVyYXRpb25BcnJheS5wdXNoKG51bWJlcik7XG4gICAgfVxuICAgIHJldHVybiBvcGVyYXRpb25BcnJheTtcbiAgfVxuXG4gIC8vIGlucHV0IGEgb3BlYXJ0aW9uIGFycmF5LCBvdXRwdXQgdG8gYSBwb3N0Zml4IGFycmF5XG4gIHRvUG9zdGZpeChvcGVyYXRpb25BcnJheSkge1xuICAgIGNvbnN0IG9wZXJhdGlvblBvc3RmaXggPSBbXTtcbiAgICBjb25zdCBvcGVyYXRvclN0YWNrID0gW107XG4gICAgY29uc3QgaGVhdnlPcGVyYXRvciA9ICcqLyUnO1xuICAgIGNvbnN0IGxpZ2h0T3BlcmF0b3IgPSAnKy0nO1xuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgb3BlcmF0aW9uQXJyYXkubGVuZ3RoOyBpKyspIHtcbiAgICAgIGlmICh0aGlzLm9wZXJhdG9yQ29sbGVjdGlvbi5pbmNsdWRlcyhvcGVyYXRpb25BcnJheVtpXSkpIHtcbiAgICAgICAgaWYgKG9wZXJhdG9yU3RhY2subGVuZ3RoID09PSAwKSB7XG4gICAgICAgICAgb3BlcmF0b3JTdGFjay5wdXNoKG9wZXJhdGlvbkFycmF5W2ldKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBjb25zdCB1cHBlcm1vc3RPcGVyYXRvciA9IG9wZXJhdG9yU3RhY2tbb3BlcmF0b3JTdGFjay5sZW5ndGggLSAxXTtcbiAgICAgICAgICBpZiAoXG4gICAgICAgICAgICBoZWF2eU9wZXJhdG9yLmluY2x1ZGVzKG9wZXJhdGlvbkFycmF5W2ldKSAmJlxuICAgICAgICAgICAgbGlnaHRPcGVyYXRvci5pbmNsdWRlcyh1cHBlcm1vc3RPcGVyYXRvcilcbiAgICAgICAgICApIHtcbiAgICAgICAgICAgIG9wZXJhdG9yU3RhY2sucHVzaChvcGVyYXRpb25BcnJheVtpXSk7XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIG9wZXJhdGlvblBvc3RmaXgucHVzaChvcGVyYXRvclN0YWNrLnBvcCgpKTtcbiAgICAgICAgICAgIG9wZXJhdG9yU3RhY2sucHVzaChvcGVyYXRpb25BcnJheVtpXSk7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBvcGVyYXRpb25Qb3N0Zml4LnB1c2gob3BlcmF0aW9uQXJyYXlbaV0pO1xuICAgICAgfVxuICAgIH1cbiAgICB3aGlsZSAob3BlcmF0b3JTdGFjay5sZW5ndGggPiAwKSB7XG4gICAgICBvcGVyYXRpb25Qb3N0Zml4LnB1c2gob3BlcmF0b3JTdGFjay5wb3AoKSk7XG4gICAgfVxuICAgIHJldHVybiBvcGVyYXRpb25Qb3N0Zml4O1xuICB9XG5cbiAgY29tcHV0ZSgpIHtcbiAgICB0aGlzLmluc3RhbnRSZXN1bHQgPSB0aGlzLm9wZXJhdGlvbjtcbiAgICBjb25zdCBvcGVyYXRpb25BcnJheSA9IHRoaXMub3BlcmF0aW9uVG9BcnJheSh0aGlzLmluc3RhbnRSZXN1bHQpO1xuICAgIGNvbnN0IG9wZXJhdGlvblBvc3RmaXggPSB0aGlzLnRvUG9zdGZpeChvcGVyYXRpb25BcnJheSk7XG4gICAgY29uc3QgcmVzdWx0ID0gW107XG4gICAgb3BlcmF0aW9uUG9zdGZpeC5mb3JFYWNoKG9wZXJhdGlvbiA9PiB7XG4gICAgICBpZiAodGhpcy5vcGVyYXRvckNvbGxlY3Rpb24uaW5jbHVkZXMob3BlcmF0aW9uKSkge1xuICAgICAgICBjb25zdCBzZWNvbmRPcGVyYXRpb24gPSByZXN1bHQucG9wKCk7XG4gICAgICAgIGNvbnN0IGZpcnN0T3BlcmF0aW9uID0gcmVzdWx0LnBvcCgpO1xuICAgICAgICBzd2l0Y2ggKG9wZXJhdGlvbikge1xuICAgICAgICAgIGNhc2UgJysnOlxuICAgICAgICAgICAgcmVzdWx0LnB1c2goZmlyc3RPcGVyYXRpb24gKyBzZWNvbmRPcGVyYXRpb24pO1xuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgY2FzZSAnLSc6XG4gICAgICAgICAgICByZXN1bHQucHVzaChmaXJzdE9wZXJhdGlvbiAtIHNlY29uZE9wZXJhdGlvbik7XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgICBjYXNlICcqJzpcbiAgICAgICAgICAgIHJlc3VsdC5wdXNoKGZpcnN0T3BlcmF0aW9uICogc2Vjb25kT3BlcmF0aW9uKTtcbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgIGNhc2UgJy8nOlxuICAgICAgICAgICAgcmVzdWx0LnB1c2goZmlyc3RPcGVyYXRpb24gLyBzZWNvbmRPcGVyYXRpb24pO1xuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgY2FzZSAnJSc6XG4gICAgICAgICAgICByZXN1bHQucHVzaChmaXJzdE9wZXJhdGlvbiAlIHNlY29uZE9wZXJhdGlvbik7XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgfVxuICAgICAgfSBlbHNlIHtcbiAgICAgICAgcmVzdWx0LnB1c2goTnVtYmVyKG9wZXJhdGlvbikpO1xuICAgICAgfVxuICAgIH0pO1xuICAgIHRoaXMuaW5zdGFudFJlc3VsdCA9XG4gICAgICBpc05hTihyZXN1bHRbMF0pIHx8IHJlc3VsdFswXSA9PT0gSW5maW5pdHkgPyBOYU4gOiByZXN1bHRbMF0udG9TdHJpbmcoKTtcbiAgfVxuXG4gIGdldFJlc3VsdCgpIHtcbiAgICBpZiAoaXNOYU4odGhpcy5pbnN0YW50UmVzdWx0KSkge1xuICAgICAgY29uc29sZS5sb2coJ+S4jeimgemaqOS+v+S6gui8uOWFpeWlveWXjj8g6Ziy5ZGG5b6I57SvJyk7XG4gICAgfSBlbHNlIGlmICh0aGlzLmluc3RhbnRSZXN1bHQgPT09ICcnKSB7XG4gICAgICBjb25zb2xlLmxvZygn55yL6LW35L6G5L2g5LiN6ZyA6KaB6KiI566XJyk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMub3BlcmF0aW9uID0gdGhpcy5pbnN0YW50UmVzdWx0O1xuICAgICAgdGhpcy5pbnN0YW50UmVzdWx0ID0gJyc7XG4gICAgfVxuICB9XG5cbiAgLy8gYWRkICcsJyB0byBudW1iZXJcbiAgZ2V0RGlzcGxheU51bWJlcihudW1iZXIpIHtcbiAgICBjb25zdCBudW1iZXJTdHJpbmcgPSBudW1iZXIudG9TdHJpbmcoKTtcbiAgICBjb25zdCBpbnRlZ2VyRGlnaXRzID0gcGFyc2VGbG9hdChudW1iZXJTdHJpbmcuc3BsaXQoJy4nKVswXSk7XG4gICAgY29uc3QgZGVjaW1hbERpZ2l0cyA9IG51bWJlclN0cmluZy5zcGxpdCgnLicpWzFdOyAvLyBkZWNpbWFsRGlnaXRzIGlzIGEgc3RyaW5nXG4gICAgbGV0IGludGVnZXJEaXNwbGF5O1xuICAgIGlmIChpc05hTihpbnRlZ2VyRGlnaXRzKSkge1xuICAgICAgaW50ZWdlckRpc3BsYXkgPSAnJztcbiAgICB9IGVsc2Uge1xuICAgICAgaW50ZWdlckRpc3BsYXkgPSBpbnRlZ2VyRGlnaXRzLnRvTG9jYWxlU3RyaW5nKCdlbicsIHtcbiAgICAgICAgbWF4aW11bUZyYWN0aW9uRGlnaXRzOiAwLFxuICAgICAgfSk7XG4gICAgfVxuICAgIGlmIChkZWNpbWFsRGlnaXRzICE9IG51bGwpIHtcbiAgICAgIHJldHVybiBgJHtpbnRlZ2VyRGlzcGxheX0uJHtkZWNpbWFsRGlnaXRzfWA7XG4gICAgfVxuICAgIHJldHVybiBpbnRlZ2VyRGlzcGxheTtcbiAgfVxuXG4gIGdldERpc3BsYXkob3BlcmF0aW9uQXJyYXkpIHtcbiAgICBsZXQgZGlzcGxheSA9ICcnO1xuICAgIG9wZXJhdGlvbkFycmF5LmZvckVhY2gob3BlcmF0aW9uID0+IHtcbiAgICAgIGlmICh0aGlzLm9wZXJhdG9yQ29sbGVjdGlvbi5pbmNsdWRlcyhvcGVyYXRpb24pKSB7XG4gICAgICAgIGRpc3BsYXkgKz0gb3BlcmF0aW9uO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgZGlzcGxheSArPSB0aGlzLmdldERpc3BsYXlOdW1iZXIob3BlcmF0aW9uKTtcbiAgICAgIH1cbiAgICB9KTtcbiAgICByZXR1cm4gZGlzcGxheTtcbiAgfVxuXG4gIHVwZGF0ZURpc3BsYXkoKSB7XG4gICAgY29uc3Qgb3BlcmF0aW9uQXJyYXkgPSB0aGlzLm9wZXJhdGlvblRvQXJyYXkodGhpcy5vcGVyYXRpb24pO1xuICAgIHRoaXMub3BlcmF0aW9uVGV4dEVsZW1lbnQuaW5uZXJUZXh0ID0gdGhpcy5nZXREaXNwbGF5KG9wZXJhdGlvbkFycmF5KTtcbiAgICBpZiAoaXNOYU4odGhpcy5pbnN0YW50UmVzdWx0KSkge1xuICAgICAgdGhpcy5pbnN0YW50UmVzdWx0VGV4dEVsZW1lbnQuaW5uZXJUZXh0ID0gJyc7XG4gICAgfSBlbHNlIHtcbiAgICAgIGNvbnN0IHJlc3VsdEFycmF5ID0gdGhpcy5vcGVyYXRpb25Ub0FycmF5KHRoaXMuaW5zdGFudFJlc3VsdCk7XG4gICAgICB0aGlzLmluc3RhbnRSZXN1bHRUZXh0RWxlbWVudC5pbm5lclRleHQgPSB0aGlzLmdldERpc3BsYXkocmVzdWx0QXJyYXkpO1xuICAgIH1cbiAgfVxufVxuXG5jb25zdCBudW1iZXJCdXR0b25zID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnW2RhdGEtbnVtYmVyXScpO1xuY29uc3Qgb3BlcmF0b3JCdXR0b25zID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnW2RhdGEtb3BlcmF0b3JdJyk7XG5jb25zdCBkZWxldGVCdXR0b24gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCdbZGF0YS1kZWxldGVdJyk7XG5jb25zdCBjbGVhckJ1dHRvbiA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJ1tkYXRhLWNsZWFyXScpO1xuY29uc3QgZXF1YWxzQnV0dG9uID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignW2RhdGEtZXF1YWxzXScpO1xuY29uc3Qgb3BlcmF0aW9uVGV4dEVsZW1lbnQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCdbZGF0YS1vcGVyYXRpb25dJyk7XG5jb25zdCBpbnN0YW50UmVzdWx0VGV4dEVsZW1lbnQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFxuICAnW2RhdGEtaW5zdGFudC1yZXN1bHRdJ1xuKTtcblxubGV0IGNhbGN1bGF0b3JPcGVyYXRvciA9ICcnO1xub3BlcmF0b3JCdXR0b25zLmZvckVhY2goYnV0dG9uID0+IHtcbiAgY2FsY3VsYXRvck9wZXJhdG9yICs9IGJ1dHRvbi5pbm5lclRleHQ7XG59KTtcbmNvbnN0IGNhbGN1bGF0b3IgPSBuZXcgQ2FsY3VsYXRvcihcbiAgb3BlcmF0aW9uVGV4dEVsZW1lbnQsXG4gIGluc3RhbnRSZXN1bHRUZXh0RWxlbWVudCxcbiAgY2FsY3VsYXRvck9wZXJhdG9yXG4pO1xuXG4vLyBpbnB1dCBieSBjbGlja1xubnVtYmVyQnV0dG9ucy5mb3JFYWNoKGJ1dHRvbiA9PiB7XG4gIGJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsICgpID0+IHtcbiAgICBjYWxjdWxhdG9yLmFwcGVuZE51bWJlcihidXR0b24uaW5uZXJUZXh0KTtcbiAgICBjYWxjdWxhdG9yLmNvbXB1dGUoKTtcbiAgICBjYWxjdWxhdG9yLnVwZGF0ZURpc3BsYXkoKTtcbiAgfSk7XG59KTtcblxub3BlcmF0b3JCdXR0b25zLmZvckVhY2goYnV0dG9uID0+IHtcbiAgYnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKCkgPT4ge1xuICAgIGNhbGN1bGF0b3IuYXBwZW5kT3BlcmF0b3IoYnV0dG9uLmlubmVyVGV4dCk7XG4gICAgY2FsY3VsYXRvci5jb21wdXRlKCk7XG4gICAgY2FsY3VsYXRvci51cGRhdGVEaXNwbGF5KCk7XG4gIH0pO1xufSk7XG5cbmVxdWFsc0J1dHRvbi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsICgpID0+IHtcbiAgY2FsY3VsYXRvci5nZXRSZXN1bHQoKTtcbiAgY2FsY3VsYXRvci51cGRhdGVEaXNwbGF5KCk7XG59KTtcblxuY2xlYXJCdXR0b24uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoKSA9PiB7XG4gIGNhbGN1bGF0b3IuY2xlYXIoKTtcbiAgY2FsY3VsYXRvci51cGRhdGVEaXNwbGF5KCk7XG59KTtcblxuZGVsZXRlQnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKCkgPT4ge1xuICBjYWxjdWxhdG9yLmRlbGV0ZSgpO1xuICBjYWxjdWxhdG9yLmNvbXB1dGUoKTtcbiAgY2FsY3VsYXRvci51cGRhdGVEaXNwbGF5KCk7XG59KTtcblxuLy8gaW5wdXQgYnkga2V5Ym9hcmRcbmNvbnN0IG51bWJlckFyciA9IFsnMScsICcyJywgJzMnLCAnNCcsICc1JywgJzYnLCAnNycsICc4JywgJzknLCAnMCcsICcuJ107XG5kb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCdrZXlkb3duJywgZSA9PiB7XG4gIGlmIChudW1iZXJBcnIuaW5jbHVkZXMoZS5rZXkpKSB7XG4gICAgY2FsY3VsYXRvci5hcHBlbmROdW1iZXIoZS5rZXkpO1xuICAgIGNhbGN1bGF0b3IuY29tcHV0ZSgpO1xuICB9IGVsc2UgaWYgKGUua2V5ID09PSAnQmFja3NwYWNlJykge1xuICAgIGNhbGN1bGF0b3IuZGVsZXRlKCk7XG4gICAgY2FsY3VsYXRvci5jb21wdXRlKCk7XG4gIH0gZWxzZSBpZiAoXG4gICAgZS5rZXkgPT09ICctJyB8fFxuICAgIGUua2V5ID09PSAnLycgfHxcbiAgICAoZS5zaGlmdEtleSAmJiAoZS5rZXkgPT09ICcrJyB8fCBlLmtleSA9PT0gJyonIHx8IGUua2V5ID09PSAnJScpKVxuICApIHtcbiAgICBjYWxjdWxhdG9yLmFwcGVuZE9wZXJhdG9yKGUua2V5KTtcbiAgICBjYWxjdWxhdG9yLmNvbXB1dGUoKTtcbiAgfSBlbHNlIGlmIChlLmtleSA9PT0gJ0VudGVyJyB8fCBlLmtleSA9PT0gJz0nKSB7XG4gICAgY2FsY3VsYXRvci5nZXRSZXN1bHQoKTtcbiAgfSBlbHNlIGlmIChlLmtleSA9PT0gJ0VzY2FwZScpIHtcbiAgICBjYWxjdWxhdG9yLmNsZWFyKCk7XG4gIH1cbiAgY2FsY3VsYXRvci51cGRhdGVEaXNwbGF5KCk7XG59KTtcblxuLy8gc3dpdGNoIGRhcmsgYW5kIGxpZ2h0IG1vZGVcbmNvbnN0IGNvbG9yVGhlbWVTd2l0Y2ggPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcjY29sb3JUaGVtZScpO1xuY29uc3QgY29sb3JUaGVtZSA9IGxvY2FsU3RvcmFnZS5nZXRJdGVtKCdjb2xvclRoZW1lJyk7XG5pZiAoY29sb3JUaGVtZSA9PT0gJ2RhcmsnKSB7XG4gIGNvbG9yVGhlbWVTd2l0Y2guY2hlY2tlZCA9IHRydWU7XG4gIGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5zZXRBdHRyaWJ1dGUoJ2RhdGEtdGhlbWUnLCAnZGFyaycpO1xufSBlbHNlIHtcbiAgLy8gaWYgY29sb3JUaGVtZSA9PT0gbnVsbCB3aWxsIGdvZXMgaGVyZVxuICBjb2xvclRoZW1lU3dpdGNoLmNoZWNrZWQgPSBmYWxzZTtcbiAgZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LnNldEF0dHJpYnV0ZSgnZGF0YS10aGVtZScsICdsaWdodCcpO1xufVxuY29sb3JUaGVtZVN3aXRjaC5hZGRFdmVudExpc3RlbmVyKCdjaGFuZ2UnLCBmdW5jdGlvbigpIHtcbiAgaWYgKHRoaXMuY2hlY2tlZCkge1xuICAgIGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5zZXRBdHRyaWJ1dGUoJ2RhdGEtdGhlbWUnLCAnZGFyaycpO1xuICAgIGxvY2FsU3RvcmFnZS5zZXRJdGVtKCdjb2xvclRoZW1lJywgJ2RhcmsnKTtcbiAgfSBlbHNlIHtcbiAgICBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQuc2V0QXR0cmlidXRlKCdkYXRhLXRoZW1lJywgJ2xpZ2h0Jyk7XG4gICAgbG9jYWxTdG9yYWdlLnNldEl0ZW0oJ2NvbG9yVGhlbWUnLCAnbGlnaHQnKTtcbiAgfVxufSk7XG4iXX0=
